import{_ as s,c as i,o as a,V as t}from"./chunks/framework.6DK9nIBo.js";const y=JSON.parse('{"title":"📓 cron定时任务","description":"","frontmatter":{},"headers":[],"relativePath":"webdev/cron定时任务.md","filePath":"webdev/cron定时任务.md"}'),e={name:"webdev/cron定时任务.md"},n=t(`<h1 id="cron定时任务" tabindex="-1">📓 cron定时任务 <a class="header-anchor" href="#cron定时任务" aria-label="Permalink to &quot;:notebook: cron定时任务&quot;">​</a></h1><h2 id="linux-cron-命令" tabindex="-1">linux cron 命令 <a class="header-anchor" href="#linux-cron-命令" aria-label="Permalink to &quot;linux cron 命令&quot;">​</a></h2><p><code>crontab -e</code> : 修改定时启动列表 <code>crontab -l</code> : 查看定时列表 <code>service cron start</code> : 启动 <code>service cron restart</code> : 重启 <code>service cron status</code> : 检查状态 <code>service cron</code> : 查询cron可用的命令</p><blockquote><p>! ⚠️ 因为不知到为社么在ubuntu里面用指定版本python启动不了py脚本,所以用了shell脚本启动</p></blockquote><blockquote><p>! ⚠️建议使用sudo 执行</p></blockquote><h2 id="使用脚本启动py脚本" tabindex="-1">使用脚本启动py脚本 <a class="header-anchor" href="#使用脚本启动py脚本" aria-label="Permalink to &quot;使用脚本启动py脚本&quot;">​</a></h2><hr><h3 id="脚本" tabindex="-1">脚本 <a class="header-anchor" href="#脚本" aria-label="Permalink to &quot;脚本&quot;">​</a></h3><p><code>python 脚本</code></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logtxt </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;./loglist.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;+a&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> time.strftime(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;%Y-%m-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">%d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> %H:%M:%S&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,time.localtime(time.time())) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">logtxt.write(time)</span></span></code></pre></div><p><code>启动脚本</code></p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#!/bin/bash</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#dirname $0 为定位到脚本的根目录 其实不用绝对定位也可以</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> \`</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dirname</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> $0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ||</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> exit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#绝对定位</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/bin/python3.11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /home/ubuntu/myshell/logtest.py</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#相对定位</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python3.11</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ./logtest.py</span></span></code></pre></div><h3 id="执行" tabindex="-1">执行 <a class="header-anchor" href="#执行" aria-label="Permalink to &quot;执行&quot;">​</a></h3><p><code>添加到cron list</code> 执行命令<code>sudo crontab -e</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> *</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /home/ubuntu/myshell/logtest.sh</span></span></code></pre></div><p>⚠️ 在线crontab时间转换 <a href="https://tool.lu/crontab/" target="_blank" rel="noreferrer">crontab时间计算</a></p><p><code>:wq</code>保全退出</p><p><code>sudo crobtab -l</code> 查看是否有在列表</p><p>如果定时不执行的话尝试<code>sudo service cron reload</code> | <code> sudo service cron restart</code></p><p>现在系统每隔1分钟就会在文件里面写入一个时间!</p><h3 id="补充" tabindex="-1">补充 <a class="header-anchor" href="#补充" aria-label="Permalink to &quot;补充&quot;">​</a></h3><p>使用git的时候需要把打印的信息保存 避免错误</p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/bin/git</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> pull</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~/wk/gitlog.txt</span></span></code></pre></div>`,23),h=[n];function l(p,k,o,r,d,c){return a(),i("div",null,h)}const F=s(e,[["render",l]]);export{y as __pageData,F as default};
