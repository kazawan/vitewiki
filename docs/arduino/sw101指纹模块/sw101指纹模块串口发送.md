# SW101 指纹模块串口发送


::: tip 资料
上位机 和 应用手册
[ HLK-ZW101 详细资料](https://h.hlktech.com/Mobile/download/fdetail/281.html)
[校验和快捷生成网站](https://www.metools.info/code/c128.html)
:::

## 校验和 注意事项

::: warning
校验和是从包标识至校验和之间所有字节之和，包含包标识不包含校验和，超出 2 字节的进
位忽略。
:::

## 3.3.2.2 自动验证指纹 PS_AutoIdentify

### 功能说明：
自动采集指纹包含获取图像，生成特征，搜索指纹等功能。如表 2-1 中加密等级设置为 0 或 0x01 情况下支持此功能。

#### 输入参数：
- 分数等级
- ID 号

#### 返回参数：
- 确认字
- 页码（相配指纹模板）

#### 指令代码：0x32

#### 指令包格式：

| 包头 | 设备地址 | 包标识 | 包长度 | 指令码 | 分数等级 | ID 号 | 参数 | 校验和 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0xEF01 | xxxx | 01H | 0008H | 32H | xxH | xxxxH | xxxxH |  |

#### 辅助说明：

- ID 号：2byte，大端模式。比如录入 1 号指纹，则是 0001H。    
- ID 号为 0xFFFF，则进行 1:N 搜索；否则进行 1:1 匹配。   
- 参数：最低位为 bit0。    
  - bit0：采图背光灯控制位，0-LED 长亮，1-LED 获取图像成功后灭；    
  - bit1：保留     
  - bit2：验证过程中，是否要求模组返回关键步骤，0-要求返回，1-不要求返回
  - bit3：是否允许覆盖ID 号，0-不允许，1-允许；   
  - bit4: bit4：允许指纹重复注册控制位，0-允许，1-不允许；    
  - bit5：注册时，多次指纹采集过程中，是否要求手指离开才能进入下一
次指纹图像采集， 0-要求离开；1-不要求离开；   
  - bit6~bit15：预留。

::: tip 参数bit
00 09   -> 0000 0000 0000 1001
表示  
- bit0 ->  采图背光灯控制位，0-LED 长亮，1-LED 获取图像成功后灭；  
- bit3：是否允许覆盖ID 号，0-不允许，1-允许；  
- bit4: bit4：允许指纹重复注册控制位，0-允许，1-不允许；    
- bit5：注册时，多次指纹采集过程中，是否要求手指离开才能进入下一
次指纹图像采集， 0-要求离开；1-不要求离开； 
:::

#### 应答包格式：

| 包头 | 设备地址 | 包标识 | 包长度 | 确认码 | 参数 | ID 号 | 得分 | 校验和 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| 0xEF01 | xxxx | 07H | 0008H | xxH | 00H | xxxxH | xxxxH | sum |

#### 确认码、参数 1 和参数 2 的返回值：

| 确认码 | 释义 | 参数 释义 |
| --- | --- | --- |
| 00H | 成功 | 00H 指纹合法性检测 |
| 01H | 失败 | 01H 获取图像 |
| 07H | 生成特征失败 | 05H 已注册指纹比对 |
| 09H | 没搜索到指纹 |  |
| 0bH | ID 号超出范围 |  |
| 17H | 残留指纹 |  |
| 23H | 指纹模板为空 |  |
| 24H | 指纹库为空 |  |
| 26H | 超时 |  |
| 27H | 表示指纹已存在 |  |

#### 指令说明：

1. 若指纹库为空，则确认码和参数返回（以下直接描述为返回）：24 00H。
2. 若指定 ID 号无效，则返回 0b 00H。
3. 指令合法性检测成功，返回 00 00H，并进入指纹录入。
4. 在设定的超时时间内，若没有完成一次完整的指纹录入，则返回 26 00H，结束流程。
5. 检查输入的指纹图像的正确性。若不正确，则等待下次采集图像。
6. 若输入指纹正确，则返回 00 01H，即录入指纹获取图像成功。
7. 若生产特征失败，则返回 09 05H，结束流程。
8. 生成特征成功后，把当前采集到的指纹模板与已登记的指纹模板之间进行比对，并返回其结果。
9. 若收到 PS_Cancel 指令，则终止该指令并返回应答。

#### 示例

```c
ef 01 ff ff ff ff 01 00 08 31 00 01 04 00 09 00 48 
```


## 3.3.2.3 自动验证指纹 PS_AutoIdentify
### 功能说明：
自动采集指纹，包含获取图像、生成特征、搜索指纹等功能。如果目标模板同当前采集的指纹比对得分大于最高阀值，并且目标模板为不完整特征则以采集的特征更新目标模板的空白区域。一站式搜索包含获取图像，生成特征，搜索指纹等功能。

### 输入参数：
- 安全等级
- ID 号

### 返回参数：
- 确认字
- 页码（相配指纹模板）

### 指令代码：0x32

### 指令包格式：

| 名称      | 内容        | 字节数 |
| --------- | ----------- | ------ |
| 包头      | 0xEF01 xxxx | 2 bytes|
| 芯片地址  | xxxx        | 4 bytes|
| 包标识    | 01H         | 1 byte |
| 包长度    | 0008H       | 2 bytes|
| 指令码    | 32H         | 1 byte |
| 安全等级  | xxH         | 1 byte |
| ID 号     | xxxxH       | 2 bytes|
| 参数      | xxxxH       | 1 byte |
| 校验和    |             | 2 bytes|

### 辅助说明：

- ID 号：2byte，大端模式。例如录入1号指纹，则是0001H。
- ID 号为0xFFFF，则进行1:N搜索；否则进行1:1匹配。
- 参数：最低位为bit0。
  - bit0：0-LED长亮，1-LED获取图像成功后灭；
  - bit1：0-采图图像不预处理，1-采图图像预处理；
  - bit2：表示录入过程中，中途步骤是否有成功应答：1-中途步骤不返回成功应答，0-中途步骤返回成功应答；
  - bit3~bit15：预留。

### 应答包格式：

| 名称      | 内容        | 字节数 |
| --------- | ----------- | ------ |
| 包头      | 0xEF01 xxxx | 2 bytes|
| 芯片地址  | xxxx        | 4 bytes|
| 包标识    | 07H         | 1 byte |
| 包长度    | 0008H       | 2 bytes|
| 确认码    | xxH         | 1 byte |
| 参数      | 00H         | 1 byte |
| ID 号     | xxxxH       | 2 bytes|
| 得分      | xxxxH       | 2 bytes|
| 校验和    |             | 2 bytes|

### 确认码、参数1和参数2的返回值：

| 确认码 | 释义           | 参数释义 |
| ------ | -------------- | -------- |
| 00H    | 成功           | 00H 指纹合法性检测 |
| 01H    | 失败           | 01H 获取图像 |
| 07H    | 生成特征失败   | 05H 已注册指纹比对 |
| 09H    | 没搜索到指纹   |         |
| 0bH    | ID号超出范围   |         |
| 17H    | 残留指纹       |         |
| 23H    | 指纹模板为空   |         |
| 24H    | 指纹库为空     |         |
| 26H    | 超时           |         |
| 27H    | 表示指纹已存在 |         |

### 指令说明：

1. 若指纹库为空，则确认码和参数返回（以下直接描述为返回）：24 00H。
2. 若指定ID号无效，则返回0b 00H。
3. 指令合法性检测成功，返回00 00H，并进入指纹录入。
4. 在设定的超时时间内，若没有完成一次完整的指纹录入，则返回26 00H，结束流程。
5. 检查输入的指纹图像的正确性。若不正确，则等待下次采集图像。
6. 若输入指纹正确，则返回00 01H，即录入指纹获取图像成功。
7. 若生产特征失败，则返回09 05H，结束流程。
8. 生成特征成功后，把当前采集到的指纹模板与已登记的指纹模板之间进行比对，并返回其结果。若比对失败，则返回09 05H，结束流程；若比对成功，则返回00 05H，以及正确的ID号码和得分。
9. 若收到PS_Cancel指令，则终止该指令并返回应答。


### 示例
```c
// 读取id 为 1的用户指纹
ef 01 ff ff ff ff 01 00 08 32 01 00 01 00 00 00 3d 
```

## 3.3.1.10 删除模板 PS_DeletChar
### 功能说明：
删除 flash 数据库中指定 ID 号开始的 N 个指纹模板。

### 输入参数：
- PageID（指纹库模板号）
- N（删除的模板个数）。

### 返回参数：
- 确认字

### 指令代码：0cH

### 指令包格式：
| 名称     | 内容        | 字节数 |
| -------- | ----------- | ------ |
| 包头     | 0xEF01 xxxx | 2 bytes|
| 芯片地址 | xxxx        | 4 bytes|
| 包标识   | 01H         | 1 byte |
| 包长度   | 0007H       | 2 bytes|
| 指令码   | 0cH         | 1 byte |
| 页码     | PageID      | 2 bytes|
| 删除个数 | N           | 2 bytes|
| 校验和   |             | 2 bytes|

### 应答包格式：
| 名称     | 内容        | 字节数 |
| -------- | ----------- | ------ |
| 包头     | 0xEF01 xxxx | 2 bytes|
| 芯片地址 | xxxx        | 4 bytes|
| 包标识   | 07H         | 1 byte |
| 包长度   | 0003H       | 2 bytes|
| 确认码   | xxH         | 1 byte |
| 校验和   |             | 2 bytes|

### 说明：
- 确认码 `00H` 表示删除模板成功；
- 确认码 `01H` 表示收包有错；
- 确认码 `10H` 表示删除模板失败；
- `sum` 指校验和。